#!/usr/bin/env bash

# up=$(uptime | cut -d' ' -f5)
# prompt="Up ${up%,}"
up=$(uptime -p)
prompt=" ${HOSTNAME}: ${up#up } of /つ ◕_◕\つ"

# Set font to Font Awesome 5 Free if this is gibberish
# hibernation: ,
choice=$(echo -e "\n\n\n\n" | \
    rofi -dmenu -theme ~/.config/rofi/themes/powermenu.rasi \
    -selected-row 0 -p "$prompt")

case $choice in
    )
        lockmeup
        ;;
    )
        count=$(loginctl list-sessions | wc -l) # of lines in session output
        [[ "$count" -gt 4 ]] && { # normally 4 if no TTYs
            urxvt -name "floater" -geometry "34x$((count+2))" -e bash \
                -c "loginctl list-sessions; echo -n 'There are active TTYs! '; read"
        } || systemctl poweroff
        ;;
    )
        lockmeup &
        sleep .4 && systemctl hibernate
        ;;
    )
        # workaround for weird behaviour on thinkpad
        lockmeup &
        sleep .4 && systemctl suspend
        ;;
    )
        case $DESKTOP_SESSION in
            bspwm)
                bspc quit & sfx shutter
                ;;
            i3)
                i3-msg exit
                ;;
            *)
                # systemctl ext?
                notify-send "NOT IMPLEMENTED"
                ;;
        esac
        ;;
    *)
        exit 1
        ;;
esac

